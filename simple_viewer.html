<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>トランザクション一覧</title>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
	<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<style>
		body { font-size: 62.5%; }
		label, input { display:block; }
		fieldset { padding:0; border:0; margin-top:25px; }
		h1 { font-size: 1.2em; margin: .6em 0; }
		div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
		div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }

		.ui-dialog .ui-state-error { padding: .3em; }
		.validateTips { border: 1px solid transparent; padding: 0.3em; }
	</style>
	<script>
$(function() {

	function sendAjax(){
		var URL ="http://xx.xx.xx.xx:7895/account/transfers/all?address=" + address;
		return $.ajax({url: URL ,type: 'GET'});
	}

	var address;
	if (1 < document.location.search.length) {
		var query = document.location.search.substring(1);

		var params = query.split('&');
		var item = new Object();
		for (var i = 0; i < params.length; i++) {
			var element = params[i].split('=');
			var index  = decodeURIComponent(element[0]);
			var value = decodeURIComponent(element[1]);
			item[index] = decodeURIComponent(value);
		}
		address = item["address"];
	}

	sendAjax().done(
		function(result){

			var dataArray = result.data;
			dataArray.forEach(function(val){
			
				var tran = val.transaction;
				var mosaics = tran.mosaics;
				var strMosaics = "";
				if(mosaics){
					mosaics.forEach(function(mval){
						console.log(mval);
						strMosaics += mval.quantity + mval.mosaicId.name + "<br />";
					});
				}
				$( "#users tbody" ).append( "<tr>" +
					"<td>" + tran.timeStamp + "</td>" +
					"<td>" + tran.type + "</td>" +
					"<td>" + tran.fee + "</td>" +
					"<td>" + tran.recipient + "</td>" +
					"<td>" + tran.signer + "</td>" +
					"<td>" + strMosaics + "</td>" +
				"</tr>" );
			});
		}
	);

});

  </script>
</head>
<body>
<div id="users-contain" class="ui-widget">
<h1>直近のトランザクション:</h1>
  <table id="users" class="ui-widget ui-widget-content">
	<thead>
	  <tr class="ui-widget-header ">
		<th>timeStamp</th>
		<th>type</th>
		<th>fee</th>
		<th>recipient</th>
		<th>signer</th>
		<th>mosaics</th>
	  </tr>
	</thead>
	<tbody>
	</tbody>
  </table>
</div>
 
</body>
</html>

